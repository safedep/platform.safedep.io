import { NextResponse } from "next/server";

type MockReportType = {
  package_version: {
    package: {
      ecosystem: string;
      name: string;
    };
    version: string;
  };
  target: {
    origin: string;
  };
  file_system: {
    files: Array<{
      key: string;
      origin: string;
      derived_extension?: string;
      mime_type?: string;
    }>;
  };
  file_evidences: Array<{
    file_key: string;
    evidence: {
      title: string;
      behavior: string;
      details: string;
      confidence: string;
      source: string;
    };
  }>;
  project_evidences: Array<{
    evidence: {
      title: string;
      behavior: string;
      details: string;
      confidence: string;
      source: string;
    };
  }>;
  warnings: Array<{
    message: string;
  }>;
  analyzed_at: string;
  inference: {
    confidence: string;
    is_malware: boolean;
    details: string;
  };
};

// Mock data for the malware report
const mockReport: MockReportType = {
  package_version: {
    package: {
      ecosystem: "ECOSYSTEM_NPM",
      name: "llm-oracle",
    },
    version: "1.0.2",
  },
  target: {
    origin: "https://registry.npmjs.org/llm-oracle/-/llm-oracle-1.0.2.tgz",
  },
  file_system: {
    files: [
      {
        key: "package/LICENSE",
        origin: "https://registry.npmjs.org/llm-oracle/-/llm-oracle-1.0.2.tgz",
        derived_extension: "unknown",
      },
      {
        key: "package/index.js",
        origin: "https://registry.npmjs.org/llm-oracle/-/llm-oracle-1.0.2.tgz",
        derived_extension: "unknown",
      },
      {
        key: "package/package.json",
        origin: "https://registry.npmjs.org/llm-oracle/-/llm-oracle-1.0.2.tgz",
        derived_extension: "unknown",
      },
      {
        key: "package/HISTORY.md",
        origin: "https://registry.npmjs.org/llm-oracle/-/llm-oracle-1.0.2.tgz",
        derived_extension: "unknown",
      },
      {
        key: "package/README.md",
        origin: "https://registry.npmjs.org/llm-oracle/-/llm-oracle-1.0.2.tgz",
        derived_extension: "unknown",
      },
      {
        key: "package/Base64Decode.ts",
        origin: "https://registry.npmjs.org/llm-oracle/-/llm-oracle-1.0.2.tgz",
        mime_type: "application/vnd.microsoft.portable-executable",
        derived_extension: "exe",
      },
    ],
  },
  file_evidences: [
    {
      file_key: "package/Base64Decode.ts",
      evidence: {
        title: "YARA rule 'pe_packed' matched file",
        behavior: "high, windows",
        details:
          "YARA rules detected multiple potential malware behaviors in the file.",
        confidence: "CONFIDENCE_MEDIUM",
        source: "YARA Analyzer",
      },
    },
    {
      file_key: "package/Base64Decode.ts",
      evidence: {
        title: "Embedded Executable",
        behavior: "The package contains an embedded executable file",
        details:
          "The package contains an embedded executable file with name: `package/Base64Decode.ts` and MIME Type: `application/vnd.microsoft.portable-executable`",
        confidence: "CONFIDENCE_HIGH",
        source: "File Meta Analyzer",
      },
    },
    {
      file_key: "package/Base64Decode.ts",
      evidence: {
        title: "Extension Mismatch",
        behavior: "The file extension does not match the file name",
        details:
          "The file extension `.ts` observed in `package/Base64Decode.ts` does not match the detected extension `exe` identified through file content analysis",
        confidence: "CONFIDENCE_LOW",
        source: "File Meta Analyzer",
      },
    },
  ],
  project_evidences: [
    {
      evidence: {
        title: "Untrustworthy source project",
        behavior: "Untrustworthy source project",
        details:
          "The source project for the package is not popular and has a low OpenSSF score. This could indicate that the package is not well maintained, has low community support or is potentially malicious.",
        confidence: "CONFIDENCE_LOW",
        source: "Package Project Analyzer",
      },
    },
  ],
  warnings: [
    {
      message:
        "Limit read for package file: package/Base64Decode.ts due to large size: 16773255",
    },
  ],
  analyzed_at: "2024-12-09T04:47:07.457429392Z",
  inference: {
    confidence: "CONFIDENCE_HIGH",
    is_malware: true,
    details:
      "Analyzer 'File Meta Analyzer' detected the file 'package/Base64Decode.ts' to be malware with high confidence",
  },
};
export async function GET(
  request: Request,
  context: { params: { analysisId: string } },
) {
  const { params } = context;
  const analysisId = params.analysisId;
  return NextResponse.json({ ...mockReport, id: analysisId });
}
